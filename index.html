<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Card Wallet</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="css/styles.css">
  <script>try{if(localStorage.getItem('cw_darkMode')!=='false')document.documentElement.setAttribute('data-theme','dark')}catch(e){}</script>
</head>
<body>
  <!-- Skip Navigation -->
  <a href="#view-scan" class="skip-nav" id="skip-nav">Skip to content</a>

  <!-- Onboarding Overlay (first-run) -->
  <div id="onboarding-overlay" class="onboarding-overlay hidden">
    <div class="onboarding-card">
      <div class="onboarding-icon">&#9918;&#127952;&#9917;&#127936;</div>
      <h2>Welcome to Card Wallet</h2>
      <p>Scan trading cards with AI, manage your collection, and list on eBay — all from your phone.</p>
      <div class="onboarding-steps">
        <div class="onboarding-step">
          <span class="step-number">1</span>
          <span>Snap a photo or manually add a card</span>
        </div>
        <div class="onboarding-step">
          <span class="step-number">2</span>
          <span>AI identifies it &mdash; or fill in details yourself</span>
        </div>
        <div class="onboarding-step">
          <span class="step-number">3</span>
          <span>Track your collection, list on eBay, see profits</span>
        </div>
      </div>
      <button id="onboarding-demo-btn" class="btn btn-primary" style="width:100%;margin-top:16px">Try with Sample Cards</button>
      <button id="onboarding-skip-btn" class="btn btn-secondary" style="width:100%;margin-top:8px">Start Fresh</button>
      <button id="onboarding-setup-btn" class="btn btn-secondary" style="width:100%;margin-top:8px">Set Up AI Scanning</button>
    </div>
  </div>

  <!-- Global Search Overlay -->
  <div id="global-search-overlay" class="global-search-overlay hidden">
    <div class="global-search-header">
      <input type="search" id="global-search-input" placeholder="Search all cards..." class="global-search-input" autocomplete="off">
      <button id="global-search-close" class="btn btn-secondary btn-sm">Cancel</button>
    </div>
    <div id="global-search-results" class="global-search-results"></div>
  </div>

  <!-- Full-Screen Image Viewer -->
  <div id="image-viewer" class="image-viewer hidden">
    <button class="image-viewer-close" id="image-viewer-close" aria-label="Close">&times;</button>
    <div class="image-viewer-counter" id="image-viewer-counter"></div>
    <div class="image-viewer-body" id="image-viewer-body">
      <img id="image-viewer-img" src="" alt="Card image" draggable="false">
    </div>
    <div class="image-viewer-nav">
      <button class="image-viewer-prev" id="image-viewer-prev" aria-label="Previous image">&#8592;</button>
      <button class="image-viewer-next" id="image-viewer-next" aria-label="Next image">&#8594;</button>
    </div>
  </div>

  <!-- Scanner Overlay -->
  <div id="scanner-overlay" class="scanner-overlay hidden">
    <div class="scanner-header">
      <span class="scanner-title">Adjust Card Edges</span>
    </div>
    <div class="scanner-body">
      <div id="scanner-canvas-wrap" class="scanner-canvas-wrap">
        <canvas id="scanner-canvas"></canvas>
        <canvas id="scanner-lines" class="scanner-lines"></canvas>
      </div>
      <div id="scanner-loading" class="scanner-loading hidden">
        <div class="loading-spinner"></div>
        <p>Loading image processor...</p>
      </div>
    </div>
    <div id="scanner-controls" class="scanner-controls hidden">
      <button id="scanner-use-original" class="btn btn-secondary">Use Original</button>
      <button id="scanner-apply" class="btn btn-primary">Apply</button>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay hidden">
    <div class="loading-spinner"></div>
    <p id="loading-text">Processing...</p>
  </div>

  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>

  <!-- Modal Container -->
  <div id="modal-overlay" class="modal-overlay hidden">
    <div class="modal">
      <h3 id="modal-title"></h3>
      <p id="modal-message"></p>
      <div id="modal-actions" class="modal-actions"></div>
    </div>
  </div>

  <!-- ===== SCAN VIEW ===== -->
  <div id="view-scan" class="view active" role="main" aria-label="Scan card">
    <header class="view-header">
      <h1>Scan Card</h1>
      <button id="btn-global-search" class="header-btn" aria-label="Search all cards">&#128269;</button>
    </header>
    <div class="view-content scan-content">
      <!-- API Key Gate Banner -->
      <div id="api-key-gate" class="api-key-gate hidden">
        <div class="gate-icon">&#128273;</div>
        <p><strong>API key needed for AI scanning</strong></p>
        <p>Add your Claude API key to auto-identify cards from photos. Get one at <a href="https://console.anthropic.com/" target="_blank" rel="noopener" style="color:var(--primary);font-weight:500">console.anthropic.com</a>.</p>
        <p style="font-size:12px;color:var(--gray-500);margin-bottom:12px">You can still use <strong>Manual Entry</strong> without a key.</p>
        <button id="gate-go-settings" class="btn btn-primary btn-sm">Go to Settings</button>
      </div>

      <!-- Mode Toggle -->
      <div class="mode-toggle">
        <button id="mode-listing" class="mode-btn active" data-mode="listing">Quick List</button>
        <button id="mode-collection" class="mode-btn" data-mode="collection">Collect</button>
      </div>

      <!-- Manual Entry -->
      <div style="margin-bottom:12px">
        <button id="btn-manual-entry" class="btn btn-secondary btn-sm">+ Manual Entry</button>
      </div>

      <!-- Scan Wizard (unified single + multi-card flow) -->
      <div class="scan-area" id="scan-wizard">
        <!-- Step 1: Front -->
        <div id="scan-step-front" class="batch-step">
          <div class="batch-step-label">Step 1: Front of Card</div>
          <div class="scan-slot batch-scan-slot" id="scan-slot-front">
            <label class="scan-btn" for="camera-input-front" aria-label="Scan front of card">
              <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                <circle cx="12" cy="13" r="4"/>
              </svg>
              <span>Tap to Scan</span>
            </label>
            <img id="scan-preview-front" class="scan-preview hidden" alt="Front preview">
          </div>
          <input type="file" id="camera-input-front" accept="image/*" capture="environment" class="hidden" aria-label="Capture front of card">
        </div>

        <!-- Step 2: Back -->
        <div id="scan-step-back" class="batch-step hidden">
          <div class="batch-step-label">Step 2: Back of Card</div>
          <div class="scan-slot batch-scan-slot" id="scan-slot-back">
            <label class="scan-btn" for="camera-input-back" aria-label="Scan back of card">
              <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                <circle cx="12" cy="13" r="4"/>
              </svg>
              <span>Tap to Scan</span>
            </label>
            <img id="scan-preview-back" class="scan-preview hidden" alt="Back preview">
          </div>
          <input type="file" id="camera-input-back" accept="image/*" capture="environment" class="hidden" aria-label="Capture back of card">
          <button id="btn-skip-back" class="btn btn-secondary btn-sm" style="margin-top:8px;width:100%">Skip Back</button>
        </div>

        <!-- Step 3: Card ready prompt -->
        <div id="scan-step-ready" class="batch-step hidden">
          <div class="batch-added-check">&#10003;</div>
          <div class="batch-added-text">Card ready!</div>
          <div style="display:flex;gap:8px;margin-top:12px;width:100%">
            <button id="btn-identify-now" class="btn btn-primary" style="flex:1;white-space:nowrap">Identify Card</button>
            <button id="btn-scan-more" class="btn btn-secondary" style="flex:1;white-space:nowrap">Scan More</button>
          </div>
        </div>

        <!-- Upload from gallery -->
        <div style="margin-top:12px;text-align:center">
          <label class="btn btn-secondary btn-sm" for="gallery-upload" style="cursor:pointer">+ Upload from Gallery</label>
          <input type="file" id="gallery-upload" accept="image/*" multiple class="hidden" aria-label="Upload photos from gallery">
        </div>
      </div>

      <!-- Scan Queue (appears when multiple cards are queued) -->
      <div id="scan-queue-section" class="hidden">
        <div id="scan-queue" class="batch-queue"></div>
        <button id="btn-identify-all" class="btn btn-primary" style="width:100%;margin-bottom:12px" disabled>Identify All</button>
      </div>

      <!-- Recent Scans -->
      <div class="recent-scans">
        <h3>Recent Scans</h3>
        <div id="recent-scans-list" class="recent-scans-list">
          <div class="empty-state-rich">
            <div class="empty-state-icon">&#128247;</div>
            <div class="empty-state-title">No cards scanned yet</div>
            <div class="empty-state-desc">Tap the camera above to snap a photo of any trading card and get started.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== CARD REVIEW VIEW ===== -->
  <div id="view-review" class="view" role="main" aria-label="Review card">
    <header class="view-header">
      <button id="review-back" class="header-btn" aria-label="Go back">&#8592; Back</button>
      <h1>Review Card</h1>
      <button id="review-save" class="header-btn primary">Save</button>
    </header>
    <div class="view-content review-content">
      <!-- Card Image Previews (front + back) -->
      <div class="review-images">
        <div class="review-image-container">
          <span class="image-label">Front</span>
          <img id="review-image-front" src="" alt="Card front">
          <label class="add-back-btn hidden" id="review-add-front-label" for="review-add-front-input">+ Add Photo</label>
          <input type="file" id="review-add-front-input" accept="image/*" capture="environment" class="hidden">
        </div>
        <div class="review-image-container">
          <span class="image-label">Back</span>
          <img id="review-image-back" src="" alt="Card back" class="hidden">
          <label class="add-back-btn hidden" id="review-add-back-label" for="review-add-back-input">+ Add Back</label>
          <input type="file" id="review-add-back-input" accept="image/*" capture="environment" class="hidden">
        </div>
      </div>

      <!-- Valuation Badge -->
      <div id="review-valuation-badge" class="valuation-badge hidden"></div>

      <!-- Card Fields -->
      <form id="review-form" class="review-form">
        <div class="form-row">
          <div class="form-group">
            <label for="field-sport">Sport</label>
            <select id="field-sport">
              <option value="">Select...</option>
              <option value="Baseball">Baseball</option>
              <option value="Basketball">Basketball</option>
              <option value="Football">Football</option>
              <option value="Hockey">Hockey</option>
              <option value="Soccer">Soccer</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="field-year">Year</label>
            <input type="text" id="field-year" placeholder="2023" inputmode="numeric">
          </div>
        </div>

        <div class="form-group">
          <label for="field-brand">Brand</label>
          <input type="text" id="field-brand" placeholder="Topps, Panini, Upper Deck...">
        </div>

        <div class="form-group">
          <label for="field-setName">Set Name</label>
          <input type="text" id="field-setName" placeholder="Chrome, Prizm, Select...">
        </div>

        <div class="form-group">
          <label for="field-subset">Subset / Insert</label>
          <input type="text" id="field-subset" placeholder="Rookie, All-Star, Base...">
        </div>

        <div class="form-group">
          <label for="field-parallel">Parallel / Variation</label>
          <input type="text" id="field-parallel" placeholder="Refractor, Silver, Gold...">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="field-cardNumber">Card #</label>
            <input type="text" id="field-cardNumber" placeholder="123" inputmode="numeric">
          </div>
          <div class="form-group">
            <label for="field-serialNumber">Serial #</label>
            <input type="text" id="field-serialNumber" placeholder="/99">
          </div>
        </div>

        <div class="form-group">
          <label for="field-player">Player / Subject</label>
          <input type="text" id="field-player" placeholder="Mike Trout">
        </div>

        <div class="form-group">
          <label for="field-team">Team</label>
          <input type="text" id="field-team" placeholder="Los Angeles Angels">
        </div>

        <div class="form-group">
          <label for="field-attributes">Attributes</label>
          <input type="text" id="field-attributes" placeholder="RC, Auto, Patch, Mem... (comma separated)">
        </div>

        <!-- Grading Section -->
        <div class="form-section">
          <h3>Grading</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="field-graded">Graded?</label>
              <select id="field-graded">
                <option value="No">No</option>
                <option value="Yes">Yes</option>
              </select>
            </div>
            <div class="form-group">
              <label for="field-gradeCompany">Company</label>
              <select id="field-gradeCompany">
                <option value="">N/A</option>
                <option value="PSA">PSA</option>
                <option value="BGS">BGS</option>
                <option value="SGC">SGC</option>
                <option value="CGC">CGC</option>
              </select>
            </div>
            <div class="form-group">
              <label for="field-gradeValue">Grade</label>
              <input type="text" id="field-gradeValue" placeholder="10">
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="field-condition">Condition</label>
          <select id="field-condition">
            <option value="Near Mint or Better">Near Mint or Better</option>
            <option value="Excellent">Excellent</option>
            <option value="Very Good">Very Good</option>
            <option value="Good">Good</option>
            <option value="Fair">Fair</option>
            <option value="Poor">Poor</option>
          </select>
        </div>

        <!-- Purchase Price (both modes) -->
        <div class="form-group">
          <label for="field-purchasePrice">Purchase Price ($)</label>
          <input type="number" id="field-purchasePrice" step="0.01" placeholder="What you paid">
        </div>

        <!-- eBay Title (Listing mode) -->
        <div id="listing-fields" class="form-section">
          <h3>Listing Details</h3>
          <div class="form-group">
            <label for="field-ebayTitle">eBay Title <span id="title-char-count" class="char-count" aria-live="polite">(0/80)</span></label>
            <input type="text" id="field-ebayTitle" maxlength="80" placeholder="Auto-generated title" aria-describedby="title-char-count">
          </div>
          <div class="form-group">
            <label for="field-startPrice">Start Price ($)</label>
            <input type="number" id="field-startPrice" step="0.01" placeholder="0.99">
          </div>
          <button type="button" id="btn-check-sold" class="btn btn-secondary btn-sm" style="margin-top:4px">Check Sold Prices</button>
          <div id="sold-prices-results" class="sold-prices-results hidden">
            <div class="sold-prices-stats" id="sold-prices-stats"></div>
            <div class="sold-prices-list" id="sold-prices-list"></div>
            <button type="button" id="btn-use-suggested" class="btn btn-primary btn-sm" style="margin-top:8px">Use Suggested Price</button>
          </div>
        </div>

        <div class="form-group">
          <label for="field-notes">Notes</label>
          <textarea id="field-notes" rows="2" placeholder="Any additional notes..."></textarea>
        </div>

        <!-- Comp data (populated automatically by sold price lookup) -->
        <div id="comp-results" class="comp-results hidden">
          <div class="form-row">
            <div class="form-group">
              <label for="field-compLow">Comp Low</label>
              <input type="number" id="field-compLow" step="0.01" placeholder="$">
            </div>
            <div class="form-group">
              <label for="field-compAvg">Comp Avg</label>
              <input type="number" id="field-compAvg" step="0.01" placeholder="$">
            </div>
            <div class="form-group">
              <label for="field-compHigh">Comp High</label>
              <input type="number" id="field-compHigh" step="0.01" placeholder="$">
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== DASHBOARD VIEW ===== -->
  <div id="view-dashboard" class="view" role="main" aria-label="Dashboard">
    <header class="view-header">
      <h1>Dashboard</h1>
    </header>
    <div id="demo-banner" class="demo-banner hidden">
      <span>You're viewing sample cards.</span>
      <button id="demo-clear-btn" class="btn btn-sm btn-secondary">Clear Demo Cards</button>
    </div>
    <div class="view-content" id="dashboard-content">
      <p class="empty-state">Loading...</p>
    </div>
  </div>

  <!-- ===== ACTIVE LISTINGS VIEW ===== -->
  <div id="view-listings" class="view" role="main" aria-label="Active Listings">
    <header class="view-header">
      <h1>Active Listings</h1>
      <button id="btn-refresh-listings" class="header-btn" aria-label="Refresh listings">&#x21bb;</button>
    </header>
    <div class="view-content">
      <div class="listings-refresh-status" id="listings-refresh-status">
        <span id="listings-last-refreshed">Not yet refreshed</span>
        <span id="listings-auto-badge" class="auto-refresh-badge">Auto-refresh: 5min</span>
      </div>
      <div id="listings-list" class="active-listings-container">
        <div class="empty-state-rich">
          <div class="empty-state-icon">&#128179;</div>
          <div class="empty-state-title">No active listings</div>
          <div class="empty-state-desc">Use Quick List mode to list cards on eBay.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== COLLECTION VIEW ===== -->
  <div id="view-collection" class="view" role="main" aria-label="Collection">
    <header class="view-header">
      <span id="collection-value" class="header-value"></span>
      <h1>Collection</h1>
      <span id="collection-count" class="header-badge">0</span>
    </header>
    <div class="view-content">
      <div class="collection-toolbar">
        <input type="search" id="collection-search" placeholder="Search cards..." class="search-input" aria-label="Search collection">
        <div class="filter-pills" id="filter-pills">
          <button class="pill active" data-filter="all">All</button>
          <button class="pill" data-filter="Baseball">Baseball</button>
          <button class="pill" data-filter="Basketball">Basketball</button>
          <button class="pill" data-filter="Football">Football</button>
          <button class="pill" data-filter="Hockey">Hockey</button>
          <button class="pill" data-filter="Soccer">Soccer</button>
        </div>
        <div class="sort-row">
          <select id="collection-sort">
            <option value="dateAdded-desc">Newest First</option>
            <option value="dateAdded-asc">Oldest First</option>
            <option value="player-asc">Player A-Z</option>
            <option value="player-desc">Player Z-A</option>
            <option value="year-desc">Year (Newest)</option>
            <option value="year-asc">Year (Oldest)</option>
            <option value="value-desc">Value (Highest)</option>
            <option value="value-asc">Value (Lowest)</option>
          </select>
          <div class="view-mode-toggle">
            <button class="view-mode-btn active" data-mode="grid" aria-label="Grid view" title="Grid">&#9638;</button>
            <button class="view-mode-btn" data-mode="list" aria-label="List view" title="List">&#9776;</button>
            <button class="view-mode-btn" data-mode="binder" aria-label="Binder view" title="Binder">&#128218;</button>
          </div>
        </div>
      </div>
      <div id="collection-grid" class="collection-grid">
        <div class="empty-state-rich" style="grid-column:1/-1">
          <div class="empty-state-icon">&#127183;</div>
          <div class="empty-state-title">Your collection is empty</div>
          <div class="empty-state-desc">Scan cards in "Collect" mode to start building your collection.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== CARD DETAIL VIEW ===== -->
  <div id="view-detail" class="view" role="main" aria-label="Card details">
    <header class="view-header">
      <button id="detail-back" class="header-btn" aria-label="Go back">&#8592; Back</button>
      <h1>Card Details</h1>
      <button id="detail-edit" class="header-btn">Edit</button>
    </header>
    <div class="view-content detail-content" id="detail-content">
      <!-- Populated dynamically -->
    </div>
  </div>

  <!-- ===== SETTINGS VIEW ===== -->
  <div id="view-settings" class="view" role="main" aria-label="Settings">
    <header class="view-header">
      <h1>Settings</h1>
    </header>
    <div class="view-content settings-content">
      <!-- Account — always visible, first thing you see -->
      <div id="settings-account" class="settings-section">
        <h3>Account</h3>
        <!-- Signed-out state (visible by default) -->
        <div id="auth-signed-out">
          <div class="form-group">
            <label for="auth-email">Email</label>
            <input type="email" id="auth-email" placeholder="you@example.com">
          </div>
          <div class="form-group">
            <label for="auth-password">Password</label>
            <input type="password" id="auth-password" placeholder="Password">
          </div>
          <div style="display:flex;align-items:center;justify-content:space-between;margin-top:8px">
            <label style="font-size:13px;display:flex;align-items:center;gap:6px">
              <input type="checkbox" id="auth-remember-me" checked>
              Remember me
            </label>
            <button type="button" id="btn-forgot-password" style="font-size:13px;color:var(--primary);background:none;border:none;cursor:pointer;padding:0">Forgot password?</button>
          </div>
          <div class="btn-group-vertical" style="margin-top:8px">
            <button type="button" id="btn-sign-in" class="btn btn-primary">Sign In</button>
            <button type="button" id="btn-create-account" class="btn btn-secondary">Create Account</button>
            <button type="button" id="btn-google-sign-in" class="btn btn-secondary">Sign In with Google</button>
          </div>
        </div>
        <!-- Signed-in state -->
        <div id="auth-signed-in" class="hidden">
          <div class="auth-user-info">
            <span id="auth-user-email" class="auth-email"></span>
            <span id="auth-sync-badge" class="sync-badge">Synced</span>
          </div>
          <div class="btn-group-vertical" style="margin-top:8px">
            <button type="button" id="btn-sync-now" class="btn btn-secondary">Sync Now</button>
            <button type="button" id="btn-sign-out" class="btn btn-danger">Sign Out</button>
          </div>
        </div>
      </div>

      <!-- eBay Integration -->
      <div id="settings-ebay" class="settings-section">
        <h3>eBay Integration</h3>
        <!-- Disconnected state -->
        <div id="ebay-disconnected">
          <div class="form-group">
            <label for="setting-ebay-worker-url">Worker URL</label>
            <input type="url" id="setting-ebay-worker-url" placeholder="https://your-worker.workers.dev">
            <small>Your Cloudflare Worker proxy URL</small>
          </div>
          <div class="form-group">
            <label for="setting-ebay-client-id">eBay Client ID</label>
            <input type="text" id="setting-ebay-client-id" placeholder="Your eBay App ID (Client ID)">
          </div>
          <div class="form-group">
            <label for="setting-ebay-runame">eBay RuName</label>
            <input type="text" id="setting-ebay-runame" placeholder="Your eBay Redirect URL name (RuName)">
            <small>Found under User Tokens &gt; Your eBay Sign-in Settings</small>
          </div>
          <button type="button" id="btn-ebay-sign-in" class="btn btn-primary" style="margin-top:8px">Sign In with eBay</button>
        </div>
        <!-- Connected state -->
        <div id="ebay-connected" class="hidden">
          <div class="ebay-connection-info">
            <span class="ebay-status-badge">Connected</span>
          </div>
          <button type="button" id="btn-ebay-disconnect" class="btn btn-danger" style="margin-top:8px">Disconnect eBay</button>
        </div>
      </div>

      <div class="settings-section">
        <h3>API Configuration</h3>
        <div class="form-group">
          <label for="setting-api-key">Claude API Key</label>
          <div class="input-with-btn">
            <input type="password" id="setting-api-key" placeholder="sk-ant-...">
            <button type="button" id="btn-toggle-api-key" class="btn btn-sm">Show</button>
          </div>
          <small>Your key is stored locally and never sent anywhere except Anthropic's API.</small>
        </div>
        <div class="form-group">
          <label for="setting-model">Model</label>
          <select id="setting-model">
            <option value="claude-haiku-4-5-20251001">Haiku 4.5 (Fastest)</option>
            <option value="claude-sonnet-4-6">Sonnet 4.6 (Balanced)</option>
            <option value="claude-sonnet-4-5-20250929">Sonnet 4.5</option>
            <option value="claude-opus-4-6">Opus 4.6 (Most Accurate)</option>
          </select>
        </div>
      </div>

      <div class="settings-section">
        <h3>Appearance</h3>
        <div class="form-group">
          <label class="toggle-row">
            <span>Dark Mode</span>
            <input type="checkbox" id="setting-dark-mode" class="toggle-input">
            <span class="toggle-switch"></span>
          </label>
        </div>
      </div>

      <div class="settings-section">
        <h3>Defaults</h3>
        <div class="form-group">
          <label for="setting-default-sport">Default Sport</label>
          <select id="setting-default-sport">
            <option value="">None</option>
            <option value="Baseball">Baseball</option>
            <option value="Basketball">Basketball</option>
            <option value="Football">Football</option>
            <option value="Hockey">Hockey</option>
            <option value="Soccer">Soccer</option>
          </select>
        </div>
        <div class="form-group">
          <label for="setting-default-condition">Default Condition</label>
          <select id="setting-default-condition">
            <option value="Near Mint or Better">Near Mint or Better</option>
            <option value="Excellent">Excellent</option>
            <option value="Very Good">Very Good</option>
            <option value="Good">Good</option>
          </select>
        </div>
        <div class="form-group">
          <label for="setting-default-price">Default Start Price ($)</label>
          <input type="number" id="setting-default-price" step="0.01" value="0.99">
        </div>
      </div>

      <div class="settings-section">
        <h3>Data Management</h3>
        <div class="btn-group-vertical">
          <button id="btn-export-data" class="btn btn-secondary">Export All Data (JSON)</button>
          <label class="btn btn-secondary">
            Import Data (JSON)
            <input type="file" id="btn-import-data" accept=".json" class="hidden">
          </label>
          <button id="btn-clear-data" class="btn btn-danger">Clear All Data</button>
        </div>
      </div>

      <!-- Trash / Recently Deleted -->
      <div class="settings-section">
        <h3>Recently Deleted</h3>
        <p id="trash-empty-msg" class="trash-empty-msg">No deleted cards.</p>
        <div id="trash-list" class="trash-list"></div>
        <div id="trash-actions" class="trash-actions hidden">
          <button id="btn-restore-all-trash" class="btn btn-secondary btn-sm">Restore All</button>
          <button id="btn-empty-trash" class="btn btn-danger btn-sm">Empty Trash</button>
        </div>
      </div>

      <div class="settings-section">
        <h3>Stats</h3>
        <div id="settings-stats" class="stats-grid">
          <div class="stat-item">
            <span class="stat-value" id="stat-total">0</span>
            <span class="stat-label">Total Cards</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="stat-listings">0</span>
            <span class="stat-label">Listings</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="stat-collection">0</span>
            <span class="stat-label">Collection</span>
          </div>
        </div>
      </div>

      <p class="app-version">Card Wallet v5.11.0</p>
    </div>
  </div>

  <!-- ===== BOTTOM TAB BAR ===== -->
  <nav class="tab-bar" role="navigation" aria-label="Main navigation">
    <button class="tab active" data-view="scan" aria-label="Scan card">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
        <circle cx="12" cy="13" r="4"/>
      </svg>
      <span>Scan</span>
    </button>
    <button class="tab" data-view="dashboard" aria-label="Dashboard">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/>
      </svg>
      <span>Dashboard</span>
    </button>
    <button class="tab" data-view="listings" aria-label="Active listings">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/>
        <line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>
      </svg>
      <span>Active</span>
    </button>
    <button class="tab" data-view="collection" aria-label="View collection">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
        <rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
      </svg>
      <span>Collection</span>
    </button>
    <button class="tab" data-view="settings" aria-label="Settings">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <circle cx="12" cy="12" r="3"/>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
      </svg>
      <span>Settings</span>
    </button>
  </nav>

  <!-- Firebase Compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-storage-compat.js"></script>

  <!-- Scripts -->
  <script type="module" src="js/app.js"></script>
</body>
</html>
